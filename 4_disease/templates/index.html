<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ title }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      .gradient-bg {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }
      .caries-bg {
        background: linear-gradient(135deg, #ff6b6b20, #ff6b6b40);
      }
      .calculus-bg {
        background: linear-gradient(135deg, #ffa50020, #ffa50040);
      }
      .healthy-bg {
        background: linear-gradient(135deg, #51cf6620, #51cf6640);
      }
      .discoloration-bg {
        background: linear-gradient(135deg, #4ecdc420, #4ecdc440);
      }
      .upload-area {
        border: 2px dashed #cbd5e1;
        border-radius: 12px;
        transition: all 0.3s ease;
      }
      .upload-area:hover {
        border-color: #667eea;
        background-color: #f8fafc;
      }
      .disease-card {
        transition: all 0.3s ease;
        border-left: 4px solid;
      }
      .caries-card {
        border-left-color: #ff6b6b;
      }
      .calculus-card {
        border-left-color: #ffa500;
      }
      .healthy-card {
        border-left-color: #51cf66;
      }
      .discoloration-card {
        border-left-color: #4ecdc4;
      }
      .progress-ring {
        transform: rotate(-90deg);
        transform-origin: 50% 50%;
      }
      .chart-bar {
        transition: width 0.5s ease-in-out;
      }
    </style>
  </head>
  <body class="bg-gradient-to-br from-blue-50 to-purple-50 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-xl">
      <div class="container mx-auto px-4 py-6">
        <div class="flex flex-col md:flex-row justify-between items-center">
          <div>
            <h1 class="text-3xl font-bold">
              <i class="fas fa-tooth mr-3"></i>Dental Disease Classifier
            </h1>
            <p class="text-gray-200 mt-2">
              AI-powered detection of dental conditions
            </p>
          </div>
          {% if not model_loaded %}
          <div class="mt-4 md:mt-0">
            <span
              class="bg-yellow-500 text-white px-3 py-1 rounded-full text-sm font-bold"
            >
              <i class="fas fa-exclamation-triangle mr-1"></i>Test Mode
            </span>
          </div>
          {% endif %}
        </div>
      </div>
    </header>

    <main class="container mx-auto px-4 py-8 max-w-6xl">
      <!-- Disease Cards Info -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
        {% for info in class_info %}
        <div
          class="disease-card rounded-lg p-4 {% if info.name == 'caries' %}caries-card caries-bg{% elif info.name == 'calculus' %}calculus-card calculus-bg{% elif info.name == 'healthy' %}healthy-card healthy-bg{% else %}discoloration-card discoloration-bg{% endif %}"
        >
          <div class="flex items-start">
            <span class="text-2xl mr-3">{{ info.icon }}</span>
            <div>
              <h3 class="font-bold text-lg capitalize">{{ info.name }}</h3>
              <p class="text-sm text-gray-700">{{ info.description }}</p>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>

      <!-- Upload Section -->
      <div class="bg-white rounded-2xl shadow-xl p-6 mb-8">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">
          <i class="fas fa-cloud-upload-alt mr-2"></i>Upload Dental Image
        </h2>

        <!-- Tabs -->
        <div class="mb-6">
          <div class="border-b border-gray-200">
            <nav class="flex space-x-8">
              <button
                id="single-tab"
                onclick="switchTab('single')"
                class="py-3 px-1 font-medium text-lg border-b-2 border-blue-500 text-blue-600"
              >
                <i class="fas fa-image mr-2"></i>Single Image
              </button>
              <button
                id="batch-tab"
                onclick="switchTab('batch')"
                class="py-3 px-1 font-medium text-lg border-b-2 border-transparent text-gray-500"
              >
                <i class="fas fa-layer-group mr-2"></i>Batch Analysis
              </button>
            </nav>
          </div>
        </div>

        <!-- Single Upload -->
        <div id="single-section">
          <form
            action="/predict"
            method="post"
            enctype="multipart/form-data"
            class="space-y-6"
          >
            <div
              class="upload-area p-8 text-center cursor-pointer"
              onclick="document.getElementById('singleFile').click()"
            >
              <input
                type="file"
                id="singleFile"
                name="file"
                accept="image/*"
                class="hidden"
                onchange="showFileName(this, 'single')"
              />

              <div class="py-8">
                <div
                  class="w-20 h-20 mx-auto mb-4 rounded-full bg-gradient-to-br from-blue-100 to-purple-100 flex items-center justify-center"
                >
                  <i class="fas fa-tooth text-3xl text-blue-500"></i>
                </div>
                <p class="text-gray-600 mb-2">Click to upload dental image</p>
                <p class="text-gray-500 text-sm">JPG, PNG ‚Ä¢ Max 10MB</p>
                <button
                  type="button"
                  class="mt-4 gradient-bg hover:opacity-90 text-white px-6 py-2 rounded-lg"
                >
                  Choose Image
                </button>
              </div>

              <div
                id="singleFileName"
                class="mt-4 text-blue-600 font-medium hidden"
              ></div>
            </div>

            <button
              type="submit"
              class="w-full gradient-bg hover:opacity-90 text-white font-bold py-3 rounded-lg text-lg"
            >
              <i class="fas fa-search mr-2"></i>Analyze Dental Image
            </button>
          </form>
        </div>

        <!-- Batch Upload -->
        <div id="batch-section" class="hidden">
          <form
            action="/predict_batch"
            method="post"
            enctype="multipart/form-data"
            class="space-y-6"
          >
            <div
              class="upload-area p-8 text-center cursor-pointer"
              onclick="document.getElementById('batchFiles').click()"
            >
              <input
                type="file"
                id="batchFiles"
                name="files"
                accept="image/*"
                multiple
                class="hidden"
                onchange="showFileCount(this)"
              />

              <div class="py-8">
                <div
                  class="w-20 h-20 mx-auto mb-4 rounded-full bg-gradient-to-br from-purple-100 to-pink-100 flex items-center justify-center"
                >
                  <i class="fas fa-images text-3xl text-purple-500"></i>
                </div>
                <p class="text-gray-600 mb-2">
                  Click to upload multiple images
                </p>
                <p class="text-gray-500 text-sm">
                  Hold Ctrl/Cmd to select multiple files
                </p>
                <button
                  type="button"
                  class="mt-4 bg-gradient-to-r from-purple-500 to-pink-500 hover:opacity-90 text-white px-6 py-2 rounded-lg"
                >
                  Choose Files
                </button>
              </div>

              <div
                id="batchFileInfo"
                class="mt-4 text-purple-600 font-medium hidden"
              ></div>
            </div>

            <button
              type="submit"
              class="w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:opacity-90 text-white font-bold py-3 rounded-lg text-lg"
            >
              <i class="fas fa-search mr-2"></i>Analyze All Images
            </button>
          </form>
        </div>
      </div>

      <!-- Results Section -->
      {% if result %}
      <div class="bg-white rounded-2xl shadow-xl p-6 mb-8">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">
          <i class="fas fa-chart-bar mr-2"></i>Analysis Results
        </h2>

        <div class="grid lg:grid-cols-3 gap-8">
          <!-- Left Column: Image -->
          <div class="lg:col-span-1">
            <div
              class="bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-4"
            >
              <h3 class="font-bold text-gray-700 mb-3">Uploaded Image</h3>
              <div class="relative">
                <img
                  src="{{ image_url }}"
                  alt="Dental scan"
                  class="w-full rounded-lg shadow-lg"
                />
                <div
                  class="absolute top-2 right-2 bg-black/70 text-white text-xs px-2 py-1 rounded"
                >
                  {{ result.upload_time }}
                </div>
              </div>
              <div class="mt-3 p-3 bg-white rounded-lg">
                <p class="text-sm text-gray-600 truncate">
                  {{ result.filename }}
                </p>
                <p class="text-xs text-gray-500 mt-1">
                  Processing: {{ result.processing_time_ms }} ms
                </p>
              </div>
            </div>
          </div>

          <!-- Middle Column: Prediction -->
          <div class="lg:col-span-2">
            <div class="space-y-6">
              <!-- Main Prediction Card -->
              <div
                class="rounded-xl p-6 {% if result.prediction == 'caries' %}caries-bg{% elif result.prediction == 'calculus' %}calculus-bg{% elif result.prediction == 'healthy' %}healthy-bg{% else %}discoloration-bg{% endif %}"
              >
                <div
                  class="flex flex-col md:flex-row justify-between items-center"
                >
                  <div>
                    <div class="flex items-center mb-2">
                      <span class="text-3xl mr-3">{{ result.icon }}</span>
                      <h3 class="text-2xl font-bold capitalize">
                        {{ result.prediction }}
                      </h3>
                    </div>
                    <p class="text-gray-700">{{ result.description }}</p>
                  </div>
                  <div class="mt-4 md:mt-0">
                    <!-- Confidence Circle -->
                    <div class="relative w-24 h-24">
                      <svg class="w-full h-full" viewBox="0 0 100 100">
                        <!-- Background circle -->
                        <circle
                          cx="50"
                          cy="50"
                          r="45"
                          stroke="#e5e7eb"
                          stroke-width="8"
                          fill="none"
                        />
                        <!-- Progress circle -->
                        <circle
                          cx="50"
                          cy="50"
                          r="45"
                          stroke="{{ result.color }}"
                          stroke-width="8"
                          fill="none"
                          stroke-linecap="round"
                          stroke-dasharray="283"
                          stroke-dashoffset="{{ 283 - (283 * result.confidence / 100) }}"
                          class="progress-ring"
                        />
                      </svg>
                      <div
                        class="absolute inset-0 flex items-center justify-center"
                      >
                        <div class="text-center">
                          <div class="text-2xl font-bold">
                            {{ result.confidence }}%
                          </div>
                          <div class="text-xs text-gray-600">Confidence</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Probability Chart -->
              <div class="bg-white rounded-xl p-6 border border-gray-200">
                <h4 class="font-bold text-gray-800 mb-4">
                  Probability Distribution
                </h4>
                <div class="space-y-4">
                  {% for disease, prob in result.all_probabilities.items() %} {%
                  set info = class_info|selectattr('name', 'equalto',
                  disease)|first %}
                  <div class="space-y-2">
                    <div class="flex justify-between text-sm">
                      <div class="flex items-center">
                        <span class="mr-2"
                          >{{ info.icon if info else '‚ùì' }}</span
                        >
                        <span class="font-medium capitalize"
                          >{{ disease }}</span
                        >
                      </div>
                      <span class="font-bold">{{ prob|round(4) }}</span>
                    </div>
                    <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                      <div
                        class="h-full rounded-full chart-bar"
                        style="width: {{ prob * 100 }}%; background-color: {{ info.color if info else '#666' }}"
                      ></div>
                    </div>
                  </div>
                  {% endfor %}
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Clear Button -->
        <div class="mt-8 text-center">
          <button
            onclick="clearResults()"
            class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-6 py-2 rounded-lg transition"
          >
            <i class="fas fa-trash-alt mr-2"></i>Clear Results
          </button>
        </div>
      </div>
      {% endif %}

      <!-- Batch Results -->
      {% if batch_results %}
      <div class="bg-white rounded-2xl shadow-xl p-6 mb-8">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">
          <i class="fas fa-chart-pie mr-2"></i>Batch Analysis Results
        </h2>

        <!-- Summary Stats -->
        {% set caries_count = batch_results|selectattr('prediction', 'equalto',
        'caries')|list|length %} {% set calculus_count =
        batch_results|selectattr('prediction', 'equalto',
        'calculus')|list|length %} {% set healthy_count =
        batch_results|selectattr('prediction', 'equalto', 'healthy')|list|length
        %} {% set discoloration_count = batch_results|selectattr('prediction',
        'equalto', 'discoloration')|list|length %} {% set error_count =
        batch_results|selectattr('prediction', 'equalto', 'Error')|list|length
        %}

        <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8">
          <div class="bg-gradient-to-br from-red-50 to-red-100 rounded-lg p-4">
            <div class="text-2xl font-bold text-red-700 text-center">
              {{ caries_count }}
            </div>
            <div class="text-center text-red-600 text-sm">ü¶∑ Caries</div>
          </div>
          <div
            class="bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg p-4"
          >
            <div class="text-2xl font-bold text-orange-700 text-center">
              {{ calculus_count }}
            </div>
            <div class="text-center text-orange-600 text-sm">üíé Calculus</div>
          </div>
          <div
            class="bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-4"
          >
            <div class="text-2xl font-bold text-green-700 text-center">
              {{ healthy_count }}
            </div>
            <div class="text-center text-green-600 text-sm">‚úÖ Healthy</div>
          </div>
          <div
            class="bg-gradient-to-br from-teal-50 to-teal-100 rounded-lg p-4"
          >
            <div class="text-2xl font-bold text-teal-700 text-center">
              {{ discoloration_count }}
            </div>
            <div class="text-center text-teal-600 text-sm">
              üé® Discoloration
            </div>
          </div>
          <div
            class="bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-lg p-4"
          >
            <div class="text-2xl font-bold text-yellow-700 text-center">
              {{ error_count }}
            </div>
            <div class="text-center text-yellow-600 text-sm">‚ö†Ô∏è Errors</div>
          </div>
        </div>

        <!-- Results Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          {% for item in batch_results %} {% set disease_class =
          item.prediction|lower if item.prediction != 'Error' else 'error' %}
          <div
            class="disease-card rounded-lg p-4 {% if disease_class == 'caries' %}caries-card caries-bg{% elif disease_class == 'calculus' %}calculus-card calculus-bg{% elif disease_class == 'healthy' %}healthy-card healthy-bg{% elif disease_class == 'discoloration' %}discoloration-card discoloration-bg{% else %}bg-yellow-50 border-l-yellow-500{% endif %}"
          >
            <!-- Image -->
            {% if item.image_url %}
            <div class="mb-3">
              <img
                src="{{ item.image_url }}"
                alt="{{ item.filename }}"
                class="w-full h-32 object-cover rounded-lg"
              />
            </div>
            {% endif %}

            <!-- Result -->
            <div class="flex justify-between items-center mb-2">
              <div class="flex items-center">
                {% if disease_class != 'error' %} {% set info =
                class_info|selectattr('name', 'equalto', disease_class)|first %}
                <span class="text-xl mr-2"
                  >{{ info.icon if info else '‚ùì' }}</span
                >
                {% endif %}
                <h4 class="font-bold capitalize">{{ item.prediction }}</h4>
              </div>
              <div class="text-right">
                <div class="text-lg font-bold">{{ item.confidence }}%</div>
              </div>
            </div>

            <!-- Info -->
            <div class="text-xs text-gray-600 truncate">
              {{ item.filename }}
            </div>
            <div class="text-xs text-gray-500 mt-1">
              <i class="far fa-clock mr-1"></i>{{ item.upload_time }}
            </div>

            {% if item.error %}
            <div class="mt-2 text-xs text-yellow-700">
              <i class="fas fa-exclamation-circle mr-1"></i>{{ item.error }}
            </div>
            {% endif %}
          </div>
          {% endfor %}
        </div>

        <!-- Clear Button -->
        <div class="mt-8 text-center">
          <button
            onclick="clearResults()"
            class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-6 py-2 rounded-lg"
          >
            <i class="fas fa-trash-alt mr-2"></i>Clear All Results
          </button>
        </div>
      </div>
      {% endif %}

      <!-- Error Display -->
      {% if error %}
      <div
        class="bg-gradient-to-r from-red-50 to-orange-50 border border-red-200 rounded-xl p-6 mb-8"
      >
        <div class="flex items-center">
          <div class="bg-red-100 p-3 rounded-full mr-4">
            <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
          </div>
          <div>
            <h3 class="text-lg font-bold text-red-800">Upload Error</h3>
            <p class="text-red-700 mt-1">{{ error }}</p>
          </div>
        </div>
      </div>
      {% endif %}

      <!-- Information Panel -->
      <div
        class="bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-200 rounded-2xl p-6"
      >
        <div class="grid md:grid-cols-2 gap-8">
          <div>
            <h3 class="text-xl font-bold text-blue-800 mb-4">
              <i class="fas fa-info-circle mr-2"></i>About This System
            </h3>
            <p class="text-gray-700 mb-4">
              This AI system classifies dental images into 4 categories using a
              deep learning ResNet50 model. It can detect caries, calculus,
              healthy teeth, and discoloration with high accuracy.
            </p>

            <div class="bg-white/50 rounded-lg p-4">
              <h4 class="font-bold text-gray-700 mb-2">üìÅ How to Use:</h4>
              <ol
                class="list-decimal list-inside text-sm text-gray-600 space-y-1"
              >
                <li>Upload a clear dental image</li>
                <li>AI analyzes the image instantly</li>
                <li>View detailed results with confidence scores</li>
                <li>Multiple images can be analyzed together</li>
              </ol>
            </div>
          </div>

          <div>
            <div class="bg-white/50 rounded-lg p-4 mb-4">
              <h4 class="font-bold text-gray-700 mb-2">
                ‚öïÔ∏è Medical Disclaimer
              </h4>
              <p class="text-gray-600 text-sm">
                This tool is for educational and screening purposes only. Always
                consult with a qualified dental professional for diagnosis and
                treatment.
              </p>
            </div>

            <div
              class="bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-lg p-4"
            >
              <div class="flex justify-between items-center">
                <div>
                  <h4 class="font-bold">System Status</h4>
                  <p class="text-sm opacity-90">
                    {% if model_loaded %} ‚úÖ Real Model Loaded {% else %} ‚ö†Ô∏è
                    Test Mode Active {% endif %}
                  </p>
                </div>
                <div class="text-right">
                  <div class="text-2xl font-bold">4</div>
                  <div class="text-sm opacity-90">Diseases</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer
      class="mt-12 bg-gradient-to-r from-gray-800 to-gray-900 text-white py-8"
    >
      <div class="container mx-auto px-4">
        <div class="flex flex-col md:flex-row justify-between items-center">
          <div class="mb-4 md:mb-0">
            <h3 class="text-xl font-bold mb-2">Dental Disease Classifier</h3>
            <p class="text-gray-400">AI-powered dental health screening</p>
          </div>
          <div class="text-center md:text-right">
            <p class="text-gray-400">Model: ResNet50 ‚Ä¢ Classes: 4</p>
            <p class="text-gray-500 text-sm mt-1">
              Version 1.0 ‚Ä¢ Optimized for CPU
            </p>
          </div>
        </div>
        <div
          class="border-t border-gray-700 mt-6 pt-6 text-center text-gray-400 text-sm"
        >
          <p>
            ¬© 2024 Dental AI Research Project. For educational and research
            purposes.
          </p>
        </div>
      </div>
    </footer>

    <script>
      // Switch tabs
      function switchTab(tab) {
          const singleSection = document.getElementById('single-section');
          const batchSection = document.getElementById('batch-section');
          const singleTab = document.getElementById('single-tab');
          const batchTab = document.getElementById('batch-tab');

          if (tab === 'single') {
              singleSection.classList.remove('hidden');
              batchSection.classList.add('hidden');
              singleTab.classList.add('border-blue-500', 'text-blue-600');
              singleTab.classList.remove('border-transparent', 'text-gray-500');
              batchTab.classList.add('border-transparent', 'text-gray-500');
              batchTab.classList.remove('border-blue-500', 'text-blue-600');
          } else {
              singleSection.classList.add('hidden');
              batchSection.classList.remove('hidden');
              batchTab.classList.add('border-blue-500', 'text-blue-600');
              batchTab.classList.remove('border-transparent', 'text-gray-500');
              singleTab.classList.add('border-transparent', 'text-gray-500');
              singleTab.classList.remove('border-blue-500', 'text-blue-600');
          }
      }

      // Show file name
      function showFileName(input, type) {
          const fileNameDiv = type === 'single' ?
              document.getElementById('singleFileName') :
              document.getElementById('batchFileInfo');

          if (input.files.length > 0) {
              if (type === 'single') {
                  fileNameDiv.textContent = `Selected: ${input.files[0].name}`;
              }
              fileNameDiv.classList.remove('hidden');
          }
      }

      // Show file count
      function showFileCount(input) {
          const fileInfoDiv = document.getElementById('batchFileInfo');
          if (input.files.length > 0) {
              fileInfoDiv.textContent = `${input.files.length} file(s) selected`;
              fileInfoDiv.classList.remove('hidden');
          }
      }

      // Clear results
      function clearResults() {
          window.location.href = '/';
      }

      // Animate chart bars
      function animateBars() {
          const bars = document.querySelectorAll('.chart-bar');
          bars.forEach(bar => {
              const width = bar.style.width;
              bar.style.width = '0';
              setTimeout(() => {
                  bar.style.width = width;
              }, 100);
          });
      }

      // Initialize
      document.addEventListener('DOMContentLoaded', function() {
          // Auto-switch to batch tab if batch results
          {% if batch_results %}
          switchTab('batch');
          {% endif %}

          // Animate bars if results exist
          {% if result %}
          setTimeout(animateBars, 300);
          {% endif %}
      });
    </script>
  </body>
</html>
